# 類数を計算するプログラム

実/虚二次体の類数とイデアル類群の生成元を計算するプログラムです。
個人的な実験のために作ったものであり、結果が正しいことは一切保証されません。

このプログラムは [Rust](https://www.rust-lang.org/) 言語で書かれています。実行する場合は最新版の Rust が必要です。
Rust をインストールする場合は <https://rustup.rs/> の指示に従ってください。

ソースコードの本体は `src/main.rs` です。

# 使い方

Rust がインストールされたコンピュータでコンソールから実行します。
カレントディレクトリを clone したリポジトリに移動してください。

1. 特定の値の類数を求める

    このときは `cargo run --release -- -- {dの値}` としてください。 `--` が2回登場することに注意してください。
    例えば Q(√-13) の類数を求めたい場合は `cargo run --release -- -- -13` と入力します。
    あまり d の絶対値が大きいと、計算時間が長くなりすぎたり、オーバーフロー他の意図しないエラーのために正しく計算できない場合があります。
    初めて実行するときは本体のコンパイルが実行されるため、多少時間がかかる場合があります。

    出力結果は例えば次のようになります。

    ```console
    > cargo run --release -- -- -2
        Finished release [optimized] target(s) in 0.08s
         Running `target\release\class_number.exe -- -13`
    d = -13: 2 ([(1, 0, 13), (2, 2, 7)])
    ```

    最後に出力される `d = -13: 2 ([(1, 0, 13), (2, 2, 7)])` が結果です。

    - `d = -13` はこの計算結果が Q(√-13) に対するものであることを示します。
    - `:` の後に続く `2` は Q(√-13) の類数が 2 であることを示します。
    - その後のカッコに囲まれた `[(1, 0, 13), (2, 2, 7)]` は、このイデアル類群の代表元が Za + Z(-b + √D)/2 に (a, b, c) = (1, 0, 13), (2, 2, 7) をそれぞれ代入して得られる2つのイデアルであることを示しています。

2. 特定の範囲の値の類数を求める

    a ≦ d ≦ b となるような全ての d に対する類数をそれぞれ求めたい場合は、 `cargo run --release -- -- {a} {b}` のように与えます。例えば -20 ≦ d ≦ -10 となるような全ての d について求めたい場合は次のように実行します。
    なお `d` が平方因子をもつ場合は、その `d` は無視されます。

    ```console
    > cargo run --release -- -- -20 -10
        Finished release [optimized] target(s) in 0.07s
         Running `target\release\class_number.exe -- -20 -10`
    d = -19: 1 ([(1, 1, 5)])
    d = -17: 4 ([(1, 0, 17), (2, 2, 9), (3, -2, 6), (3, 2, 6)])
    d = -15: 2 ([(1, 1, 4), (2, 1, 2)])
    d = -14: 4 ([(1, 0, 14), (2, 0, 7), (3, -2, 5), (3, 2, 5)])
    d = -13: 2 ([(1, 0, 13), (2, 2, 7)])
    d = -11: 1 ([(1, 1, 3)])
    d = -10: 2 ([(1, 0, 10), (2, 0, 5)])
    ```

3. レポートを出力する

    `-r` または `--make-report` オプションをつけることで計算過程のレポートを TeX の形式で出力させることができます。例えば Q(√-13) について類数を計算する過程を出力させるには `cargo run --release -- -r -- -13` と入力します。 
    `-r` の位置に注意してください。

    > Note: 実は `--` は他の多くのプログラムと同様で引数とオプションとを分離させるための記号です。2つ目の `--` は `cargo` への引数とこのプログラムへの引数を分けるために利用され、2つめの `--` は `-13` などの数字をオプションと解釈させないために必要になります。)

    ```console
        Finished release [optimized] target(s) in 0.08s
         Running `target\release\class_number.exe -r -- -13`

    \section{ $K = \mathbb{Q}(\sqrt{ -13 })$ }

    このとき$d = -13$である．
    $-13 \equiv 3 \mod 4$であるから，判別式を$D$とすると
    $D = -52$となる．

    まず，条件を満たす$b$の候補を計算する．$b$の範囲は
    \[ |b| \leqq  \sqrt{ \frac{ |-52| }{ 3 } } = \sqrt{ \frac{ |52| }{ 3 } } < 5. \]
    $4ac = b^2 + 52$より$b$は偶数であるから，
    条件を満たす$b$は$b = 0$, $\pm 2$, $\pm 4$．

    その上で$a \leqq c, c > 0$となるような$a, c$を求める．
    \begin{itemize}
    \item $b = 0$のとき \\
    $4ac = 52$より$ac = 13$．
    よって$(a, c) = $$(1, 13)$．
    \item $b = \pm 2$のとき \\
    $4ac = 56$より$ac = 14$．
    よって$(a, c) = $$(1, 14)$, $(2, 7)$．
    \item $b = \pm 4$のとき \\
    $4ac = 68$より$ac = 17$．
    よって$(a, c) = $$(1, 17)$．
    \end{itemize}
    以上により，ここまでの条件を満たす$(a, b, c)$の組は
    $(a, b, c) = $ $(1, 0, 13)$, $(1, -2, 14)$, $(1, 2, 14)$, $(1, -4, 17)$, $(1, 4, 17)$, $(2, -2, 7)$, $(2, 2, 7)$．
    \begin{itemize}
    \item $(a, b, c) = (1, 0, 13)$のとき \\
    これは左側の不等式$-1 < 0 \leqq 1 < 13$を満たす．
    \item $(a, b, c) = (1, -2, 14)$のとき \\
    この組は左側の不等式では$-a < b$について$-1 \not< -2$であり，右側の不等式では$0 \leqq b$について$0 \not\leqq -2$であるから，両方の不等式を満たさない.
    \item $(a, b, c) = (1, 2, 14)$のとき \\
    この組は左側の不等式では$b \leqq a$について$2 \not\leqq 1$であり，右側の不等式では$b \leqq a$について$2 \not\leqq 1$であるから，両方の不等式を満たさない.
    \item $(a, b, c) = (1, -4, 17)$のとき \\
    この組は左側の不等式では$-a < b$について$-1 \not< -4$であり，右側の不等式では$0 \leqq b$について$0 \not\leqq -4$であるから，両方の不等式を満たさない.
    \item $(a, b, c) = (1, 4, 17)$のとき \\
    この組は左側の不等式では$b \leqq a$について$4 \not\leqq 1$であり，右側の不等式では$b \leqq a$について$4 \not\leqq 1$であるから，両方の不等式を満たさない.
    \item $(a, b, c) = (2, -2, 7)$のとき \\
    この組は左側の不等式では$-a < b$について$-2 \not< -2$であり，右側の不等式では$0 \leqq b$について$0 \not\leqq -2$であるから，両方の不等式を満たさない.
    \item $(a, b, c) = (2, 2, 7)$のとき \\
    これは左側の不等式$-2 < 2 \leqq 2 < 7$を満たす．
    \end{itemize}
    以上により，全ての条件を満たす$(a, b, c)$の組は$(1, 0, 13)$, $(2, 2, 7)$となる．
    したがって，$h_K = 2$．

    イデアル類群の代表元は，
    $\left(1, \sqrt{ -13 }\right)$, $\left(2, -1 + \sqrt{ -13 }\right)$．
    ```

    この出力をファイルへリダイレクトすればレポート部分のみがファイルに得られます。これは TeX で一つのセクションを構成しているため、適切にプリアンブルを用意して `\begin{document}` から `\end{document}` の間に入れてやればコンパイルすることができます。

    レポート出力機能と先ほどの範囲指定を組み合わせることもできます。その場合、指定された全ての数字についてのレポートを出力します。広い範囲を指定すると非常に大きなソースが出力されることに注意してください。例えば -2000 ≦ d ≦ 2000 の範囲でレポートを生成すると、出力されるソースは 916525 行、それを (目次をつけて) コンパイルしたものは 25151 ページの PDF となりました。
